<?php

namespace wock\essentialx;

use pocketmine\plugin\PluginBase;
use pocketmine\Server;
use wock\essentialx\{Commands\AnvilCommand,
    Commands\BackCommand,
    Commands\BanCommand,
    Commands\BanIPCommand,
    Commands\CondenseCommand,
    Commands\ExpCommand,
    Commands\FlyCommand,
    Commands\GamemodeCommand,
    Commands\SpawnCommand,
    Events\EssentialsXEvent,
    Commands\AfkCommand};

class EssentialsX extends PluginBase {

    /** @var EssentialsX */
    private static EssentialsX $instance;

    public function onLoad(): void
    {
        self::$instance = $this;
    }
    public function onEnable(): void
    {
        $this->saveDefaultConfig();
        $this->unregisterCommands();
        $this->registerCommands();
        $this->registerEvents();
    }

    public function onDisable(): void
    {
        parent::onDisable(); // TODO: Change the autogenerated stub
    }

    public function registerCommands() {
        $this->getServer()->getCommandMap()->registerAll("essentialsx", [
            new AfkCommand($this),
            new AnvilCommand($this),
            new BackCommand($this, new EssentialsXEvent()),
            new BanCommand($this),
            new ExpCommand($this),
            new GamemodeCommand(),
            new FlyCommand(),
            new SpawnCommand($this),
            new BanIPCommand($this),
            new CondenseCommand($this)
        ]);
    }

    public function unregisterCommands() {
        Server::getInstance()->getCommandMap()->unregister(Server::getInstance()->getCommandMap()->getCommand("ban"));
        Server::getInstance()->getCommandMap()->unregister(Server::getInstance()->getCommandMap()->getCommand("ban-ip"));
        Server::getInstance()->getCommandMap()->unregister(Server::getInstance()->getCommandMap()->getCommand("gamemode"));
    }

    public function registerEvents() {
        $pluginMngr = $this->getServer()->getPluginManager();

        $pluginMngr->registerEvents(new EssentialsXEvent(), $this);
    }

    public static function getInstance(): EssentialsX
    {
        return self::$instance;
    }

}

